// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Vehicle {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  vehicleId         String
  bootId            String?                        // Unique per ESP boot session (to detect resets)
  timestamp         DateTime @default(now())        // Time of message insertion

  // Core telemetry
  rpm               Int
  throttle          Float
  speed             Float
  gear              Int
  brake             Float
  engineCoolantTemp Float
  airIntakeTemp     Float
  odoMeter          Int                             // Raw CAN byte (0â€“255)

  // Optional computed fields
  tripOdoKm         Float?                          // Odo computed by ESP (since boot)
  totalOdoKm        Float?                          // Lifetime odo computed by backend

  @@index([vehicleId, timestamp])
}

model VehicleOdometer {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  vehicleId   String   @unique
  totalOdoKm  Float
  updatedAt   DateTime @updatedAt
}